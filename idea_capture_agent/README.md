# Idea Capture Agent - System Overview

An AI-powered idea capture system that transforms raw WhatsApp messages into structured, tagged ideas in Notion.

## ğŸ¯ How It Works

```
WhatsApp Message â†’ Laravel Server â†’ AI Agent â†’ Notion Database
     (Raw Text)      (Webhook)      (Processing)  (Structured Idea)
```

### Flow Breakdown

1. **User sends WhatsApp message**
   - Raw, unstructured idea text
   - Could be messy, brief, or detailed
   - Example: "build a chrome extension that saves highlights from articles I read"

2. **Laravel server receives webhook**
   - WhatsApp Business API webhook
   - Captures message content + user identifier
   - Routes to AI agent processing

3. **AI Agent processes the idea** (Google ADK + Gemini)
   - Generates concise title (3-8 words)
   - Cleans up and structures description
   - Analyzes content to create 2-5 relevant tags
   - Adds timestamp

4. **Saves to Notion database**
   - Uses Notion API (via MCP)
   - Stores in user's connected workspace
   - Database schema: Title, Description, Tags, Date

5. **Optional: Discussion Mode**
   - Can ask user if they want to expand the idea
   - Or auto-engage in intellectual exploration
   - Helps flesh out rough concepts

## ğŸ—ï¸ Architecture

### Current Setup (Single User)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  WhatsApp   â”‚â”€â”€â”€â”€â–¶â”‚    Laravel   â”‚â”€â”€â”€â”€â–¶â”‚  AI Agent   â”‚
â”‚             â”‚     â”‚    Server    â”‚     â”‚  (Gemini)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                                                 â”‚
                                                 â–¼
                                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                         â”‚    Notion    â”‚
                                         â”‚     API      â”‚
                                         â”‚  (Your DB)   â”‚
                                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Auth:** Direct integration token (hardcoded/env)
**Limitation:** Only works for your Notion workspace

### Multi-User Setup (OAuth)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  WhatsApp   â”‚â”€â”€â”€â”€â–¶â”‚    Laravel   â”‚â”€â”€â”€â”€â–¶â”‚  AI Agent   â”‚
â”‚ (User A/B/C)â”‚     â”‚    Server    â”‚     â”‚  (Gemini)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                           â”‚                     â”‚
                           â–¼                     â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   Database   â”‚     â”‚    Notion    â”‚
                    â”‚              â”‚     â”‚     OAuth    â”‚
                    â”‚ - users      â”‚     â”‚              â”‚
                    â”‚ - tokens     â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚ - workspaces â”‚              â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
                                                  â–¼
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚   Multiple Workspaces    â”‚
                                    â”‚                          â”‚
                                    â”‚  User A â†’ Notion DB A    â”‚
                                    â”‚  User B â†’ Notion DB B    â”‚
                                    â”‚  User C â†’ Notion DB C    â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Auth:** OAuth 2.0 flow per user
**Each user:**
1. Connects their Notion workspace (OAuth)
2. Creates or auto-generates "Ideas" database in their workspace
3. Laravel stores their OAuth token
4. Agent uses appropriate token based on WhatsApp sender

## ğŸ“Š Database Requirements

### Laravel Database (MySQL/PostgreSQL)
**Required for multi-user:**
```sql
-- Users table
users (
  id,
  whatsapp_number,
  name,
  created_at
)

-- Notion OAuth tokens (encrypted)
notion_tokens (
  id,
  user_id (FK),
  access_token (encrypted),
  workspace_id,
  workspace_name,
  created_at,
  expires_at
)

-- Optional: Track databases
notion_databases (
  id,
  user_id (FK),
  database_id,
  database_name,
  created_at
)
```

### Notion Database (Per User)
**Each user needs an "Ideas" database in their own workspace with:**
- **Title** (text) - Generated by AI
- **Description** (text) - Cleaned up version
- **Tags** (multi-select) - AI-generated tags
- **Date** (date) - Creation timestamp
- **Status** (select) - Optional: New, Expanded, Archived

**Important:** YES, each user creates their own database in their Notion workspace!

**Setup Options:**
1. **Manual:** User creates database, shares with integration
2. **Auto:** Laravel creates database via Notion API after OAuth

## ğŸ¤– AI Agent Components

### Main Agent: `idea_capture`
- **Model:** Gemini 2.5 Flash
- **Framework:** Google ADK
- **Purpose:** Orchestrates all idea operations

### Sub-Agents:
1. **`add_idea`** - Processes raw text into structured ideas
2. **`expand_idea_agent`** - Intellectual discussion and expansion

### Tools:
- `list_ideas` - View all captured ideas
- `query_ideas` - Search by keywords/tags/dates
- `update_idea` - Modify existing ideas
- `expand_idea` - Generate detailed expansions
- `delete_idea` - Remove ideas

### Discussion Modes:
- **`ask_first`** (default) - Prompt user after saving
- **`auto_discuss`** - Automatically engage
- **`off`** - No discussion, just save

## ğŸ” Authentication Flow (Multi-User)

### Initial Setup
```
1. User sends WhatsApp message
2. Laravel checks if user exists
3. If new â†’ Send Notion OAuth link via WhatsApp
4. User clicks link â†’ Authorizes in Notion
5. Notion redirects to Laravel callback
6. Laravel stores token (encrypted)
7. Laravel auto-creates "Ideas" database in user's workspace
8. User receives confirmation via WhatsApp
```

### Ongoing Usage
```
1. WhatsApp message arrives at Laravel
2. Laravel identifies user by phone number
3. Fetches user's Notion token from database
4. Passes token + raw text to AI agent
5. Agent uses that token for Notion API calls
6. Idea saved to user's own workspace
7. Confirmation sent back via WhatsApp
```

## ğŸ“¡ WhatsApp Integration

**Laravel handles:**
- Webhook reception from WhatsApp Business API
- Message parsing and user identification
- User authentication/OAuth management
- Triggering AI agent with raw text + token
- Sending responses back to WhatsApp

**Agent receives from Laravel:**
```json
{
  "user_id": "user_123",
  "raw_text": "idea about building something cool",
  "notion_token": "secret_abc123...",
  "notion_database_id": "abc123..."
}
```

**Agent sends back to Laravel:**
```json
{
  "status": "success",
  "idea": {
    "title": "Building Something Cool Idea",
    "tags": ["innovation", "project-idea"]
  },
  "message": "Idea saved! Would you like to discuss it?"
}
```

## ğŸš€ Current Capabilities

âœ… Capture ideas from raw WhatsApp text
âœ… AI-generated titles, descriptions, tags
âœ… Save to Notion database
âœ… List/query/update existing ideas
âœ… Expand ideas with detailed discussion
âœ… Configurable discussion modes

ğŸ”„ **Planned:**
- Multi-user OAuth support
- Auto-database creation
- Weekly idea reports (MP3 format)
- Priority/categorization features

## ğŸ› ï¸ Tech Stack

- **Backend:** Laravel (PHP)
- **AI Framework:** Google ADK (Python)
- **LLM:** Gemini 2.5 Flash
- **Database:** MySQL/PostgreSQL (Laravel)
- **Storage:** Notion API (via MCP)
- **Messaging:** WhatsApp Business API
- **Auth:** Notion OAuth 2.0 (planned)

## ğŸ”‘ Key Design Decisions

### Why WhatsApp?
- Frictionless capture (no app switching)
- Always accessible on mobile
- Natural language input
- You already have Laravel server set up!

### Why Notion?
- Flexible database structure
- User-friendly browsing/editing
- Powerful query/filter capabilities
- Existing user workflows
- Each user gets their own workspace

### Why AI Processing?
- Raw ideas are often messy
- Automatic tagging saves time
- Consistent structure across captures
- Discussion mode helps develop ideas

### Why Google ADK?
- Built-in agent orchestration
- Tool calling framework
- Sub-agent composition
- State management

## ğŸ“ Usage Examples

### Basic Capture
```
WhatsApp: "chrome extension for saving article highlights"

Agent Response (via WhatsApp):
âœ… Idea saved!
Title: Article Highlight Chrome Extension
Tags: browser-extension, productivity, reading

Would you like to discuss and expand on this idea?
```

### Query Ideas
```
WhatsApp: "show me all productivity ideas"

Agent Response:
Found 3 productivity ideas:
1. Article Highlight Chrome Extension
2. Focus Timer with Ambient Sounds
3. Task Batching Dashboard
```

### Expand Idea
```
WhatsApp: "expand the chrome extension idea"

Agent Response:
Let's explore this deeper. What types of highlights matter most to you?
- Text selections for research?
- Images and visual content?
- Code snippets?

[Engages in discussion to flesh out requirements]
```

## ğŸ”® Future Enhancements

- **Voice notes** â†’ Transcription â†’ Idea capture
- **Image OCR** â†’ Extract text from photos
- **Collaborative workspaces** â†’ Team idea sharing
- **AI-powered connections** â†’ Link related ideas
- **Scheduled reviews** â†’ Weekly idea summaries
- **Export formats** â†’ PDF, Markdown, Audio
- **Integration triggers** â†’ Auto-create tasks in other tools

## ğŸš¦ Getting Started (Multi-User)

### 1. Notion OAuth Setup
```bash
# Create Notion integration at https://www.notion.so/my-integrations
# Set as "Public integration" for OAuth
# Copy Client ID and Client Secret
```

### 2. Laravel Configuration
```php
// .env
NOTION_CLIENT_ID=your_client_id
NOTION_CLIENT_SECRET=your_client_secret
NOTION_REDIRECT_URI=https://yourapp.com/auth/notion/callback
```

### 3. Database Migration
```bash
php artisan migrate
# Creates users, notion_tokens, notion_databases tables
```

### 4. WhatsApp Webhook
```php
// routes/api.php
Route::post('/whatsapp/webhook', [WhatsAppController::class, 'handle']);
```

### 5. OAuth Routes
```php
// routes/web.php
Route::get('/auth/notion', [NotionOAuthController::class, 'redirect']);
Route::get('/auth/notion/callback', [NotionOAuthController::class, 'callback']);
```

## ğŸ“‚ Project Structure

```
idea_capture_agent/
â”œâ”€â”€ agent.py              # Root agent definition
â”œâ”€â”€ prompt.py             # Main agent instructions
â”œâ”€â”€ tools.py              # Tool implementations
â”œâ”€â”€ agents/
â”‚   â”œâ”€â”€ add_idea/
â”‚   â”‚   â””â”€â”€ agent.py      # Add idea sub-agent
â”‚   â””â”€â”€ expand_idea/
â”‚       â””â”€â”€ agent.py      # Expand idea sub-agent
â””â”€â”€ README.md             # This file
```

---

**Last Updated:** 2025-10-18
**Status:** Production (Single User) | Planning (Multi-User OAuth)
**Integration:** WhatsApp â†’ Laravel â†’ Python AI Agent â†’ Notion
